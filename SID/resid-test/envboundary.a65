 .word $0801

; *** Symbol table  follows ***

 sstart     = $8000
 sstop      = $9000

 zINDEX        = $22
 zFREKZP       = $FB
 vControl      = $D011
 vSprEnable    = $D015
 sVoc3FreqLo   = $D40E
 sVoc3FreqHi   = $D40F
 sVoc3Control  = $D412
 sVoc3AttDec   = $D413
 sVoc3SusRel   = $D414
 sVolume       = $D418
 sVoc3Env      = $D41C
 kCHROUT       = $FFD2

; *** text follows ***

    * = $0801
    .byte $0b,$08,$01,$00,$9e,$32,$30,$36,$31,$00,$00,$00
    jmp start
        
    .dsb $1000 - *, 0

 *=$1000
start

	JSR disable

	; Release to zero
	LDA #$00
	STA sVoc3AttDec
	STA sVoc3SusRel
	STA sVoc3Control

	; Release to zero.
	LDA #$00
env00	CMP sVoc3Env
	BNE env00

	LDA #$0F
	STA sVolume

	LDX #$00
	LDY #$10
	STX sVoc3FreqLo
	STY sVoc3FreqHi

	LDA #$0F
	STA sVoc3AttDec
	LDA #$FE
	STA sVoc3SusRel

	; Start attack.
	LDA #$21
	STA sVoc3Control

	; Wait for FF (decay/sustain)
	LDA #$FF
ff	CMP sVoc3Env
	BNE ff

	; Start release.
	LDA #$20
	STA sVoc3Control

	; Start attack.
	LDA #$21
	STA sVoc3Control

eternal	JMP eternal

	JSR enable

	RTS	

disable	SEI
	LDA #$00
	STA vSprEnable
	LDA vControl
	AND #$EF
	STA vControl
vblank	; Wait for vblank (raster = 0)
raslo	BIT vControl
	BPL raslo
rashi	BIT vControl
	BMI rashi
	RTS	

enable	LDA vControl
	ORA #$10
	STA vControl
	CLI	
	RTS	

hexout	CMP #10
	BCC digit
	CLC
	ADC #$07
digit	ADC #$30
	JSR kCHROUT
	RTS

print	STX zINDEX
	STY zINDEX+1
	LDY #$00
nxtchr	LDA (zINDEX),Y
	BEQ nul
	JSR kCHROUT
	INY
	JMP nxtchr
nul	RTS
